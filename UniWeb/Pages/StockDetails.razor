@page "/stockdetails/{StockId}"
@using UniWeb.Data.Models;
@using UniWeb.Services
@inject StockServices stockServices
@inject NavigationManager Navigation

<PageTitle>Stock Details</PageTitle>

<div class="detail-container">
    <!-- Tillbaka-knappen -->
    <button class="back-button" @onclick="GoBackToHome">⬅ Tillbaka</button>

    @if (selectedStock != null)
    {
        <h2 class="detail-title">@selectedStock.Name</h2>
        <p class="detail-description">@selectedStock.Description</p>

        <!-- Bilden med onclick-event -->
        <div class="detail-image-container">
            @if (selectedStock.AnalysisImageData != null)
            {
                <img src="@($"data:{selectedStock.AnalysisImageType};base64,{Convert.ToBase64String(selectedStock.AnalysisImageData)}")"
                     alt="Stock Analysis"
                     class="detail-image"
                     @onclick="OpenModal" />
            }
            else
            {
                <img src="default-image-path.jpg" alt="Default Stock Image" class="detail-image" />
            }
            <p class="click-to-enlarge">(Click to enlarge)</p>
        </div>

        <!-- Modal för att visa bilden större -->
        @if (isModalOpen)
        {
            <div class="modal-overlay active" @onclick="CloseModal">
                <button class="close-button" @onclick="CloseModal">×</button>
                @if (selectedStock.AnalysisImageData != null)
                {
                    <img src="@($"data:{selectedStock.AnalysisImageType};base64,{Convert.ToBase64String(selectedStock.AnalysisImageData)}")"
                         alt="Stock Analysis"
                         class="modal-image" />
                }
                else
                {
                    <img src="default-image-path.jpg" alt="Default Stock Image" class="modal-image" />
                }
            </div>
        }
    }
    else
    {
        <p>No stock selected.</p>
    }
</div>


@code {
    [Parameter]
    public string StockId { get; set; }

    private Stock selectedStock;
    private bool isModalOpen = false;

    protected override void OnInitialized()
    {
        selectedStock = stockServices.GetStockById(int.Parse(StockId));
    }

    private void OpenModal()
    {
        isModalOpen = true;
    }

    private void CloseModal()
    {
        isModalOpen = false;
    }

    private void GoBackToHome()
    {
        Navigation.NavigateTo("/");
    }
}
